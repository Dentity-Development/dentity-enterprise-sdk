import ServiceBase from "./ServiceBase";
import {
    AccountProfile,
    AddWebhookRequest, AddWebhookResponse,
    CreateEcosystemRequest,
    CreateEcosystemResponse, DeleteWebhookRequest, DeleteWebhookResponse,
    EcosystemInfoRequest,
    EcosystemInfoResponse,
    GenerateTokenRequest,
    GenerateTokenResponse, GetAuthorizationsRequest, GetAuthorizationsResponse,
    GetEventTokenRequest,
    GetEventTokenResponse,
    GetOberonKeyRequest,
    GetOberonKeyResponse, GrantAuthorizationRequest, GrantAuthorizationResponse,
    InvitationStatusRequest,
    InvitationStatusResponse,
    InviteRequest,
    InviteResponse,
    ProviderDefinition, RevokeAuthorizationRequest, RevokeAuthorizationResponse,
    ServiceOptions,
    UpdateEcosystemRequest,
    UpdateEcosystemResponse,
} from "./proto";

import type { Client as BrowserClient } from "nice-grpc-web";
import base64url from "base64url";

export class ProviderService extends ServiceBase {
  client: BrowserClient<typeof ProviderDefinition>;

  constructor(options?: ServiceOptions) {
    super(options);

    this.client = this.createClient(ProviderDefinition);
  }

  public async createEcosystem(
    request: CreateEcosystemRequest
  ): Promise<CreateEcosystemResponse> {
    const response = request.name?.trim() || request.details?.email?.trim()
      ? await this.client.createEcosystem(request, {
        metadata: await this.getMetadata(
          CreateEcosystemRequest.encode(request).finish()
        ),
      })
      : await this.client.createEcosystem(request);

      const authToken = base64url(
          Buffer.from(AccountProfile.encode(response.profile!).finish())
      );
      this.options.authToken = authToken;
      return response;
  }
// BEGIN Code generated by protoc-gen-trinsic. DO NOT EDIT.
// target: ..\sdk\web\src\providerService.ts

  public async updateEcosystem(
    request: UpdateEcosystemRequest
  ): Promise<UpdateEcosystemResponse> {
    // TODO - handle metadata
    return this.client.updateEcosystem(request, {
      metadata: await this.getMetadata(
        UpdateEcosystemRequest.encode(request).finish()
      ),
    });
  }
  public async grantAuthorization(
    request: GrantAuthorizationRequest
  ): Promise<GrantAuthorizationResponse> {
    // TODO - handle metadata
    return this.client.grantAuthorization(request, {
      metadata: await this.getMetadata(
        GrantAuthorizationRequest.encode(request).finish()
      ),
    });
  }
  public async revokeAuthorization(
    request: RevokeAuthorizationRequest
  ): Promise<RevokeAuthorizationResponse> {
    // TODO - handle metadata
    return this.client.revokeAuthorization(request, {
      metadata: await this.getMetadata(
        RevokeAuthorizationRequest.encode(request).finish()
      ),
    });
  }
  public async getAuthorizations(
    request: GetAuthorizationsRequest
  ): Promise<GetAuthorizationsResponse> {
    // TODO - handle metadata
    return this.client.getAuthorizations(request, {
      metadata: await this.getMetadata(
        GetAuthorizationsRequest.encode(request).finish()
      ),
    });
  }
  public async addWebhook(
    request: AddWebhookRequest
  ): Promise<AddWebhookResponse> {
    // TODO - handle metadata
    return this.client.addWebhook(request, {
      metadata: await this.getMetadata(
        AddWebhookRequest.encode(request).finish()
      ),
    });
  }
  public async deleteWebhook(
    request: DeleteWebhookRequest
  ): Promise<DeleteWebhookResponse> {
    // TODO - handle metadata
    return this.client.deleteWebhook(request, {
      metadata: await this.getMetadata(
        DeleteWebhookRequest.encode(request).finish()
      ),
    });
  }
  public async ecosystemInfo(
    request: EcosystemInfoRequest
  ): Promise<EcosystemInfoResponse> {
    // TODO - handle metadata
    return this.client.ecosystemInfo(request, {
      metadata: await this.getMetadata(
        EcosystemInfoRequest.encode(request).finish()
      ),
    });
  }
  public async generateToken(
    request: GenerateTokenRequest
  ): Promise<GenerateTokenResponse> {
    // TODO - handle metadata
    return this.client.generateToken(request, {
      metadata: await this.getMetadata(
        GenerateTokenRequest.encode(request).finish()
      ),
    });
  }
  public async invite(
    request: InviteRequest
  ): Promise<InviteResponse> {
    // TODO - handle metadata
    return this.client.invite(request, {
      metadata: await this.getMetadata(
        InviteRequest.encode(request).finish()
      ),
    });
  }
  public async invitationStatus(
    request: InvitationStatusRequest
  ): Promise<InvitationStatusResponse> {
    // TODO - handle metadata
    return this.client.invitationStatus(request, {
      metadata: await this.getMetadata(
        InvitationStatusRequest.encode(request).finish()
      ),
    });
  }
  public async getOberonKey(
    request: GetOberonKeyRequest
  ): Promise<GetOberonKeyResponse> {
    // TODO - handle metadata
    return this.client.getOberonKey(request, {
      metadata: await this.getMetadata(
        GetOberonKeyRequest.encode(request).finish()
      ),
    });
  }
  public async getEventToken(
    request: GetEventTokenRequest
  ): Promise<GetEventTokenResponse> {
    // TODO - handle metadata
    return this.client.getEventToken(request, {
      metadata: await this.getMetadata(
        GetEventTokenRequest.encode(request).finish()
      ),
    });
  }
// END Code generated by protoc-gen-trinsic. DO NOT EDIT.
}
