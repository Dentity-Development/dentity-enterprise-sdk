package services

import (
	"context"

	"github.com/trinsic-id/sdk/go/proto/services/universalwallet/v1/wallet"
)

// NewWalletService returns a wallet service with the base service configured
// using the provided options
func NewWalletService(options *Options) (WalletService, error) {
	base, err := NewServiceBase(options)
	if err != nil {
		return nil, err
	}
	service := &walletBase{
		Service: base,
		client:  wallet.NewUniversalWalletClient(base.GetChannel()),
	}

	return service, nil
}

// WalletService defines the interface for interacting with wallet
type WalletService interface {
	Service

	// BEGIN Interface Code generated by protoc-gen-trinsic. DO NOT EDIT.
	// target: C:\work\sdk\go\services\wallet_service.go

	// GetItem  Retrieve an item from the wallet with a given item identifier
	GetItem(userContext context.Context, request *wallet.GetItemRequest) (*wallet.GetItemResponse, error)
	// Search  Search the wallet using a SQL-like syntax
	Search(userContext context.Context, request *wallet.SearchRequest) (*wallet.SearchResponse, error)
	// InsertItem  Insert an item into the wallet
	InsertItem(userContext context.Context, request *wallet.InsertItemRequest) (*wallet.InsertItemResponse, error)
	// UpdateItem  Update an item in the wallet
	UpdateItem(userContext context.Context, request *wallet.UpdateItemRequest) (*wallet.UpdateItemResponse, error)
	// DeleteItem  Delete an item from the wallet permanently
	DeleteItem(userContext context.Context, request *wallet.DeleteItemRequest) (*wallet.DeleteItemResponse, error)

	// END Interface Code generated by protoc-gen-trinsic. DO NOT EDIT.
}

type walletBase struct {
	Service
	client wallet.UniversalWalletClient
}

func (w *walletBase) Search(userContext context.Context, request *wallet.SearchRequest) (*wallet.SearchResponse, error) {
	if request == nil {
		request = &wallet.SearchRequest{}
	}

	if len(request.Query) == 0 {
		request.Query = "SELECT c.id, c.type, c.data FROM c OFFSET 0 LIMIT 100"
	}

	md, err := w.GetMetadataContext(userContext, request)
	if err != nil {
		return nil, err
	}

	response, err := w.client.Search(md, request)
	if err != nil {
		return nil, err
	}

	return response, nil
}

// BEGIN Implementation Code generated by protoc-gen-trinsic. DO NOT EDIT.
// target: C:\work\sdk\go\services\wallet_service.go

// GetItem  Retrieve an item from the wallet with a given item identifier
func (w *walletBase) GetItem(userContext context.Context, request *wallet.GetItemRequest) (*wallet.GetItemResponse, error) {
	// TODO - Handle a flag for the metadata context
	md, err := w.GetMetadataContext(userContext, request)
	if err != nil {
		return nil, err
	}
	response, err := w.client.GetItem(md, request)
	if err != nil {
		return nil, err
	}
	return response, nil
}

// InsertItem  Insert an item into the wallet
func (w *walletBase) InsertItem(userContext context.Context, request *wallet.InsertItemRequest) (*wallet.InsertItemResponse, error) {
	// TODO - Handle a flag for the metadata context
	md, err := w.GetMetadataContext(userContext, request)
	if err != nil {
		return nil, err
	}
	response, err := w.client.InsertItem(md, request)
	if err != nil {
		return nil, err
	}
	return response, nil
}

// UpdateItem  Update an item in the wallet
func (w *walletBase) UpdateItem(userContext context.Context, request *wallet.UpdateItemRequest) (*wallet.UpdateItemResponse, error) {
	// TODO - Handle a flag for the metadata context
	md, err := w.GetMetadataContext(userContext, request)
	if err != nil {
		return nil, err
	}
	response, err := w.client.UpdateItem(md, request)
	if err != nil {
		return nil, err
	}
	return response, nil
}

// DeleteItem  Delete an item from the wallet permanently
func (w *walletBase) DeleteItem(userContext context.Context, request *wallet.DeleteItemRequest) (*wallet.DeleteItemResponse, error) {
	// TODO - Handle a flag for the metadata context
	md, err := w.GetMetadataContext(userContext, request)
	if err != nil {
		return nil, err
	}
	response, err := w.client.DeleteItem(md, request)
	if err != nil {
		return nil, err
	}
	return response, nil
}

// END Implementation Code generated by protoc-gen-trinsic. DO NOT EDIT.
